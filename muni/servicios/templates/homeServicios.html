{% extends "base.html" %}
{% load static %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static "css/servicios/styles.css" %}?v1.1">
{% endblock %}

{% block content %}


<style>


    .container {
        width: 90vw; /* Coincide con el cuadro de búsqueda y los filtros */
        margin: 0 auto; /* Centra el contenido */
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* Asegura que las tarjetas estén bien distribuidas */
    }
    
    /* Ajustar la tarjeta para que se expanda sin afectar a las demás */
    .item-box {
        background-color: white;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        padding: 20px;
        position: relative;
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        overflow: hidden; /* Asegura que los elementos internos no se desborden */
    }
    
    /* Cuando pasas el mouse, la tarjeta se expande sin afectar las demás */
    .item-box:hover {
        transform: scale(1.05); /* Hace zoom solo en la tarjeta activa */
        z-index: 10; /* Asegura que se ponga encima de las demás */
        position: relative;
        box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.2); /* Efecto de sombra más fuerte */
    }
    
    /* Ícono en la esquina superior izquierda */
    .icon-box {
        position: absolute;
        top: 15px;
        left: 15px;
    }
    
    .icon {
        width: 80px;
        height: auto;
    }
    
    /* Estado Badge - Círculo */
    .estado-badge {
        position: absolute;
        top: 55px;
        right: 120px; /* Ajuste para pantallas grandes */
        background-color: #8B1E64;
        color: white;
        font-size: 14px;
        font-weight: bold;
        width: 35px;  /* Hacerlo circular asegurando mismo ancho y alto */
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%; /* Convierte el badge en círculo */
    }
    
    /* Ajustar la posición en pantallas más pequeñas */
    @media (max-width: 992px) { /* Tablets y pantallas medianas */
        .estado-badge {
            top: 60px;
            right: 100px;
        }
    }
    
    @media (max-width: 768px) { /* Dispositivos móviles */
        .estado-badge {
            top: 55px;
            right: 190px;
        }
    }
    
    @media (max-width: 576px) { /* Teléfonos más pequeños */
        .estado-badge {
            right: 150px; /* Lo dejamos pegado al borde para móviles pequeños */
        }
    }
    
    /* Pago en línea */
    .payment {
        color: #2E7D32;
        font-weight: bold;
        text-align: center;
    }
    
    .online {
        color: #8B1E64;
        font-weight: bold;
        text-align: center;
    }
    
    /* Títulos */
    .title {
        font-size: 1.25rem;
        font-weight: bold;
        text-align: left;
        margin-top: 35px; /* Para evitar que el ícono tape el texto */
    }
    
    /* Ocultar la descripción por defecto */
    .organismo {
        opacity: 0;
        transform: scale(0.95); /* Se mantiene pequeña */
        transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        
        /* Limitar la descripción a 5 líneas */
        display: -webkit-box;
        -webkit-line-clamp: 4; /* Limita a 5 líneas */
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis; /* Agrega los "..." cuando se excede */
    
        text-align: justify;
    }
    
    /* Mostrar la descripción cuando pasas el mouse */
    .item-box:hover .organismo {
        opacity: 1;
        transform: scale(1);
    }
    
    /* Botones */
    .btn-outline-warning {
        border-color: #fbc02d;
        color: #fbc02d;
    }
    
    .btn-outline-warning:hover {
        background-color: #fbc02d;
        color: white;
    }
    
    .btn-primary {
        background-color: #1976d2;
        border: none;
    }
    
    .icono-llave {
        height: 16px;
        width: auto;
        margin-right: 5px;
    }
    
    /* Ocultar los botones por defecto */
    .buttons {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    
    /* Mostrar los botones cuando el usuario pase el mouse sobre la tarjeta */
    .item-box:hover .buttons {
        opacity: 1;
    }
    
    /* Contenedor principal del cuadro de búsqueda */
    .search-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 90vw; /* Se reduce un 5% de cada lado */
        margin: 0 auto 20px auto;
        padding: 0 20px; /* Margen interno para evitar que tope con los bordes */
    }
    
    /* Cuadro de búsqueda ocupa todo el ancho */
    .input-group {
        display: flex;
        align-items: center;
        border: 2px solid #80004D;
        border-radius: 25px;
        overflow: hidden;
        width: 100%;
        max-width: none; /* No restringir el ancho */
    }
    
    /* Ajuste del input */
    .search-input {
        flex: 1;
        padding: 15px 20px;
        border: none;
        font-size: 18px;
        outline: none;
    }
    
    .search-btn {
        padding: 15px 25px;
        font-size: 18px;
    }
    
    .search-btn i {
        margin-right: 5px;
    }
    
    .reset-btn {
        padding: 15px 25px;
        font-size: 18px;
    }
    
    .reset-btn i {
        margin-right: 5px;
    }
    
    .search-btn:hover, .reset-btn:hover {
        opacity: 0.8;
    }
    
    /* Contenedor de los filtros ahora ocupa todo el ancho */
    .filters-container {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        width: 90vw; /* Se reduce un 5% de cada lado */
        gap: 20px;
        margin-top: 20px;
    }
    
    /* Ajuste de cada filtro para distribuirlos correctamente */
    .filter {
        display: flex;
        flex-direction: column;
        text-align: left;
        flex-grow: 1;
        min-width: 200px;
    }
    
    .filter label {
        font-size: 16px;
        color: #555;
        font-weight: normal;
    }
    
    .filter select {
        padding: 12px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
    }
    
    /* Responsive: Ajustar filtros en móviles */
    @media (max-width: 992px) {
        .filters-container {
            flex-direction: column;
            align-items: center;
        }
    }
    /* Paginacion y mostrar  */
    .pagination-container {
        display: flex;
        justify-content: space-between; /* Paginación a la izquierda, selección a la derecha */
        align-items: center;
        margin-top: 20px;
        width: 100%;
        padding: 10px 0;
    }
    
    /* Estilos de la paginación */
    .pagination {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .page-link {
        padding: 8px 12px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        font-size: 14px;
    }
    
    .page-link:hover {
        background-color: #0056b3;
    }
    
    .current-page {
        padding: 8px 12px;
        background-color: #0056b3;
        color: white;
        border-radius: 5px;
        font-weight: bold;
    }
    
    /* Estilos del selector de registros por página */
    .records-per-page {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .records-dropdown {
        padding: 6px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
    
</style>
<div class="search-container">
    <form method="GET" action="{% url 'homeServicios' %}">
        <div class="input-group">
            <input type="text" class="form-control search-input" name="q" placeholder="¿Qué servicio o trámite buscas?" value="{{ query }}">
            <button type="submit" class="btn search-btn">
                <i class="fas fa-search"></i> Buscar
            </button>
            <a href="{% url 'homeServicios' %}" class="btn reset-btn">
                <i class="fas fa-sync-alt"></i> Restablecer
            </a>
        </div>

        <!-- Filtros debajo del cuadro de búsqueda -->
        <div class="filters-container">
            <div class="filter">
                <label for="clasificacion">Seleccionar<br><strong>Clasificación</strong></label>
                <select id="clasificacion" name="clasificacion" class="form-select">
                    <option value="">Todas</option>
                    {% for cat in categorias %}
                    <option value="{{ cat.id }}" {% if clasificacion == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter">
                <label for="sector">Seleccionar<br><strong>Sector</strong></label>
                <select id="sector" name="sector" class="form-select">
                    <option value="">Todos</option>
                    {% for sec in sectores %}
                    <option value="{{ sec.id }}" {% if sector == sec.id|stringformat:"s" %}selected{% endif %}>{{ sec.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter">
                <label for="organismo">Seleccionar<br><strong>Dependencia, Entidad u Organismo</strong></label>
                <select id="organismo" name="organismo" class="form-select">
                    <option value="">Todos</option>
                    {% for org in dependencias %}
                    <option value="{{ org.id }}" {% if organismo == org.id|stringformat:"s" %}selected{% endif %}>{{ org.nombre }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="filter">
                <label for="canal">Seleccionar<br><strong>Canal de Presentación</strong></label>
                <select id="canal" name="canal" class="form-select">
                    <option value="">Todos</option>
                    <option value="en-linea">En línea</option>
                    <option value="presencial">Presencial</option>
                </select>
            </div>

            <div class="filter">
                <label for="orden">Seleccionar<br><strong>Nombre ascendente</strong></label>
                <select id="orden" name="orden" class="form-select">
                    <option value="asc">Ascendente</option>
                    <option value="desc">Descendente</option>
                </select>
            </div>
        </div>
    </form>
</div>

<div class="container">
    <div class="row g-4">
        {% for servicio in servicios %}
        <div class="col-md-4">
            <div class="card card-body rounded-2 h-100 item-box position-relative">
                
                <!-- Ícono en la esquina superior izquierda -->
                <div class="icon-box position-absolute">
                    <img class="icon" src="https://oficialiamayor.sonora.gob.mx/api/icons/inscripcion-registro.svg">
                </div>

                <!-- Sección de etiquetas de estado y "Pago en línea" -->
                <div class="row g-1 g-sm-2 justify-content-end align-content-center">
                    {% if servicio.estado %}
                    <div class="estado-badge">
                        +{{ servicio.estado }}
                    </div>
                    {% endif %}
                    {% if servicio.pago_en_linea %}
                    <div class="col-4">
                        <div class="payment">Pago en <br><strong>línea</strong></div>
                    </div>
                    {% endif %}
                    <div class="col-4">
                    {% if servicio.ahora_en_linea %}
                        <div class="online">Ahora en <br><strong>línea</strong></div>
                    {% endif %}
                    </div>
                </div>

                {% if not servicio.pago_en_linea and not servicio.ahora_en_linea %}
                <div style="margin-bottom: 3em;"></div>
                {% endif %}

                <!-- Título y Descripción -->
                <h4 class="fw-700 text-dark title">
                    {{ servicio.titulo }}
                </h4>
                <p class="text-secondary organismo">
                    {{ servicio.descripcion }}
                </p>

                <!-- Botones de acción -->
                <div class="buttons row g-1 justify-content-center mt-3">
                    <div class="col-6">
                        <a class="btn btn-outline-warning d-block rounded-pill" href="{% url 'detalle_servicio' servicio.id %}">
                            Ver más
                        </a>
                    </div>
                    {% if servicio.url_tramite %}
                    <div class="col-6">
                        <a class="btn btn-primary rounded-pill d-block" href="{{ servicio.url_tramite }}">
                            <img class="icono-llave" src="https://www.sonora.gob.mx/templates/shaper_helixultimate/images/logo-llave-sonora-icono-white.svg"> 
                            Iniciar trámite
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% empty %}
        <p class="text-center text-muted">No se encontraron servicios.</p>
        {% endfor %}
    </div>

    <div class="pagination-container">
        <!-- Paginación (Lado Izquierdo) -->
        <div class="pagination">
            {% if servicios.has_previous %}
                <a href="?page=1" class="page-link">&laquo; Primera</a>
                <a href="?page={{ servicios.previous_page_number }}" class="page-link">Anterior</a>
            {% endif %}
    
            <span class="current-page">{{ servicios.number }}</span>
    
            {% if servicios.has_next %}
                <a href="?page={{ servicios.next_page_number }}" class="page-link">Siguiente</a>
                <a href="?page={{ servicios.paginator.num_pages }}" class="page-link">Última &raquo;</a>
            {% endif %}
        </div>
    
        <!-- Selección de registros por página (Lado Derecho) -->
        <div class="records-per-page">
            <label for="records-select">Mostrar</label>
            <select id="records-select" class="records-dropdown" onchange="changeRecordsPerPage(this)">
                <option value="12" {% if request.GET.per_page == "12" %}selected{% endif %}>12</option>
                <option value="24" {% if request.GET.per_page == "24" %}selected{% endif %}>24</option>
                <option value="48" {% if request.GET.per_page == "48" %}selected{% endif %}>48</option>
            </select>
        </div>
    </div>
    
    <script>
        function changeRecordsPerPage(select) {
            const perPage = select.value;
            const url = new URL(window.location.href);
            url.searchParams.set('per_page', perPage);
            url.searchParams.set('page', 1);  // Reiniciar a la primera página
            window.location.href = url.toString();
        }
    </script>
    
</div>
{% endblock content %}